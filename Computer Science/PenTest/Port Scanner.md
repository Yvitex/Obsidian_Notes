# Port Scanner 
A way to detect an open [[Common Ports|port]]. And another exercse to try [[Python]]

## How to?
Open your terminal, create a new file using [[File Manipulation Command]] `gedit scanner.py`

```shell
$ gedit scanner.py&
```

Inside Scanner file, initiate a [[shebang]] with python3 as parameter
```python
#!/bin/python3
```

Here we need 3 modules, `sys`, `datetime` and `socket`
```python
import sys
import socket
from [[datetime]] import datetime
```

Datetime is used for the banner design so it is optional. Well, in the console, how we execute this is through this kind of command
```shell
$ python3 scanner.py <some ip address of router specifcally DNS server>
```

We can call the argument inside using sys module called `sys.argv`. First we will check if the user input an argument to be used. Basically, the length of the argument must be 2 (scanner.py and ip address)
```python
import sys
import socket
from datetime import datetime

if len(sys.argv) == 2:
	target = socket.gethostbyname(sys.argv[1])
else:
	print("Error: Arguments are not defined properly")
	print("python3 scanner.py <ip>")
```
`sys.argv[1]` basically get the second parameter(ip address) to be converted into a proper [[IP Adress]] or [[Host]]. If no ip address has been recognize, or not specified by the user, the console or command line will output an error. 

For the design, lets prinkle it with some mystic banner. 
```python
import sys
import socket
from datetime import datetime

if len(sys.argv) == 2:
	target = socket.gethostbyname(sys.argv[1])
else:
	print("Error: Arguments are not defined properly")
	print("python3 scanner.py <ip>")

# Banner
print("**" * 50)
print(f"Scanning target {target}")
print(f"Scan Starts at {datetime.now()}")
print("**" * 50)
```

So when we execute this code, this wil be outputed
![[Pasted image 20220626095149.png]]

In, [[Python]], we could iterate some string characters using multiplication symbol

Next is to create a [[Socket]] based on the host name the code received. The port will be an iterating range from 1 to 65535 which is the maximum [[Common Ports|port]] number.

```python
import sys
import socket
from datetime import datetime

if len(sys.argv) == 2:
	target = socket.gethostbyname(sys.argv[1])
else:
	print("Error: Arguments are not defined properly")
	print("python3 scanner.py <ip>")

# Banner
print("**" * 50)
print(f"Scanning target {target}")
print(f"Scan Starts at {datetime.now()}")
print("**" * 50)

from port in range(1, 65535):
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	socket.setdefaulttimeout(1)
	result = s.connect_ex((target, port))
	if result == 0:
		print(f"Port {port} is open")
	s.close()
```

The new code we added here is the timeout sequence, where for everyconnection that exceeds onesecond will be skipped. We check the connection if it is successful or not using the result object, when `s.connect_ex(())` returns 0, therefore it is successful, if it is one, then there is an error.  We will close the port for every connection attempt. 

```ad-Attention
collapse: open
This code is very unsophisticated, low quality and other insults. It could only attempt a connection one at a time and might take forever. So unless we provide a way to exit, we will wait forever unless it is finished and we do this by creating an event for keyboard interruption. 

```

To cure this, we do create an exception, modifying our current code. How we could exit is using `sys.exit()` method
```python
import sys
import socket
from datetime import datetime

if len(sys.argv) == 2:
	target = socket.gethostbyname(sys.argv[1])
else:
	print("Error: Arguments are not defined properly")
	print("python3 scanner.py <ip>")

# Banner
print("**" * 50)
print(f"Scanning target {target}")
print(f"Scan Starts at {datetime.now()}")
print("**" * 50)

try:
	from port in range(1, 65535):
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		socket.setdefaulttimeout(1)
		result = s.connect_ex((target, port))
		if result == 0:
			print(f"Port {port} is open")
		s.close()

except KeyboardInterrupt:
	print("Scanning Interrupted")
	sys.exit()
```

Also, we could add `socket.gaierror` which is a common error that exist related to hostname and `socket.error` which is an error for the connection in address or server
```python
import sys
import socket
from datetime import datetime

if len(sys.argv) == 2:
	target = socket.gethostbyname(sys.argv[1])
else:
	print("Error: Arguments are not defined properly")
	print("python3 scanner.py <ip>")

# Banner
print("**" * 50)
print(f"Scanning target {target}")
print(f"Scan Starts at {datetime.now()}")
print("**" * 50)

try:
	from port in range(1, 65535):
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		socket.setdefaulttimeout(1)
		result = s.connect_ex((target, port))
		if result == 0:
			print(f"Port {port} is open")
		s.close()

except KeyboardInterrupt:
	print("Scanning Interrupted")
	sys.exit()

except socket.gaierror:
	print("Hostname could not be resolved")
	sys.exit()

except socket.error:
	print("Could not connect to server")
	sys.exit()
```

Voila. We created a socket scanner. Connecting to the  [[IP Adress]] of my router...
![[Pasted image 20220626102404.png]]


Related: [[Datetime]] [[Domain Name Server|DNS]]